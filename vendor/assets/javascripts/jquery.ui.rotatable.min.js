(function(a,b){a.fn.rotate=function(c){if(c===b){c=a(this).data("degree");if(c===b){return 0}else{return c}}this.each(function(){var d="rotate("+(c)+"deg)";a(this).css({"-webkit-transform":d,"-moz-transform":d,"-ms-transform":d,"-o-transform":d,transform:d});a(this).data("degree",c)});return this};a.widget("ui.rotatable",a.ui.mouse,{options:{handle:false,angle:false,start:null,rotate:null,stop:null},handle:function(c){if(c===b){return this.options.handle}this.options.handle=c},angle:function(c){if(c===b){return this.options.angle}this.options.angle=c;this.performRotation(this.options.angle)},_create:function(){var c;if(!this.options.handle){c=a(document.createElement("div"));c.addClass("ui-rotatable-handle")}else{c=this.options.handle}this.listeners={rotateElement:a.proxy(this.rotateElement,this),startRotate:a.proxy(this.startRotate,this),stopRotate:a.proxy(this.stopRotate,this)};c.draggable({helper:"clone",start:this.dragStart,handle:c});c.bind("mousedown",this.listeners.startRotate);c.appendTo(this.element);if(this.options.angle!=false){this.elementCurrentAngle=this.options.angle;this.performRotation(this.elementCurrentAngle)}else{this.elementCurrentAngle=0}},_destroy:function(){this.element.removeClass("ui-rotatable");this.element.find(".ui-rotatable-handle").remove()},performRotation:function(c){this.element.rotate(c*180/Math.PI)},getElementOffset:function(){this.performRotation(0);var c=this.element.offset();this.performRotation(this.elementCurrentAngle);return c},getElementCenter:function(){var c=this.getElementOffset();var e=c.left+this.element.width()/2;var d=c.top+this.element.height()/2;return Array(e,d)},dragStart:function(c){if(this.element){return false}},startRotate:function(e){var c=this.getElementCenter();var d=e.pageX-c[0];var f=e.pageY-c[1];this.mouseStartAngle=Math.atan2(f,d);this.elementStartAngle=this.elementCurrentAngle;this.hasRotated=false;this._propagate("start",e);a(document).bind("mousemove",this.listeners.rotateElement);a(document).bind("mouseup",this.listeners.stopRotate);return false},rotateElement:function(g){if(!this.element||this.element.disabled){return false}var c=this.getElementCenter();var f=g.pageX-c[0];var i=g.pageY-c[1];var d=Math.atan2(i,f);var e=d-this.mouseStartAngle+this.elementStartAngle;this.performRotation(e);var h=this.elementCurrentAngle;this.elementCurrentAngle=e;this._propagate("rotate",g);if(h!=e){this._trigger("rotate",g,this.ui());this.hasRotated=true}return false},stopRotate:function(c){if(!this.element||this.element.disabled){return}a(document).unbind("mousemove",this.listeners.rotateElement);a(document).unbind("mouseup",this.listeners.stopRotate);this.elementStopAngle=this.elementCurrentAngle;if(this.hasRotated){this._propagate("stop",c)}setTimeout(function(){this.element=false},10);return false},_propagate:function(d,c){a.ui.plugin.call(this,d,[c,this.ui()]);(d!=="rotate"&&this._trigger(d,c,this.ui()))},plugins:{},ui:function(){return{element:this.element,angle:{start:this.elementStartAngle,current:this.elementCurrentAngle,stop:this.elementStopAngle}}}})})(jQuery);